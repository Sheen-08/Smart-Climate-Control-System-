import RPi.GPIO as GPIO
import time

# Pin Definitions (BCM numbering)
RPWM_PIN = 18
LPWM_PIN = 19
REN_PIN = 23
LEN_PIN = 24

# GPIO Setup
GPIO.setmode(GPIO.BCM)
GPIO.setup(RPWM_PIN, GPIO.OUT)
GPIO.setup(LPWM_PIN, GPIO.OUT)
GPIO.setup(REN_PIN, GPIO.OUT)
GPIO.setup(LEN_PIN, GPIO.OUT)

# PWM Setup
frequency = 1000  # 1kHz PWM frequency is suitable
rpwm = GPIO.PWM(RPWM_PIN, frequency)
lpwm = GPIO.PWM(LPWM_PIN, frequency)

# Start PWM with 0% duty cycle (off)
rpwm.start(0)
lpwm.start(0)

def set_peltier_state(direction, duty_cycle):
    if direction == "cool":
        GPIO.output(REN_PIN, GPIO.HIGH)
        GPIO.output(LEN_PIN, GPIO.LOW)
        rpwm.ChangeDutyCycle(duty_cycle)
        lpwm.ChangeDutyCycle(0)
    elif direction == "heat":
        GPIO.output(REN_PIN, GPIO.LOW)
        GPIO.output(LEN_PIN, GPIO.HIGH)
        rpwm.ChangeDutyCycle(0)
        lpwm.ChangeDutyCycle(duty_cycle)
    else:  # Off/Neutral
        GPIO.output(REN_PIN, GPIO.LOW)
        GPIO.output(LEN_PIN, GPIO.LOW)
        rpwm.ChangeDutyCycle(0)
        lpwm.ChangeDutyCycle(0)

try:
    # Example usage:
    print("Cooling at 50% power for 5 seconds...")
    set_peltier_state("cool", 50)
    time.sleep(5)

    print("Heating at 75% power for 5 seconds...")
    set_peltier_state("heat", 75)
    time.sleep(5)
    
    print("Turning off...")
    set_peltier_state("off", 0)
    time.sleep(2)

finally:
    rpwm.stop()
    lpwm.stop()
